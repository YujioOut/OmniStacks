<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OmniStacks Planner</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <h1>OmniStacks Planner</h1>

      <button id="addStackBtn">+ Add Stack</button>

      <div id="stacksContainer">
        <!-- Stacks will be added here -->
      </div>

      <button id="saveBtn">ðŸ’¾ Save Plan</button>
      <button id="exportBtn">ðŸ“¤ Export Plan</button>
    </div>

    <script>
      // Load saved data from localStorage
      window.onload = function () {
        const savedData = localStorage.getItem("omniStacksData");
        if (savedData) {
          const stacksData = JSON.parse(savedData);
          stacksData.forEach((stack) => {
            addStack(stack.stackName, stack.skills);
          });
        }
      };

      // Function to add a new stack
      function addStack(stackName = "", skills = []) {
        let stackDiv = document.createElement("div");
        stackDiv.className = "stack";

        let stackTitle = document.createElement("input");
        stackTitle.className = "stack-title";
        stackTitle.placeholder = "Enter Stack Name";
        stackTitle.value = stackName;

        let skillsContainer = document.createElement("div");
        skillsContainer.className = "skills-container";

        skills.forEach((skill) => {
          let skillDiv = document.createElement("div");
          skillDiv.className = "skill";

          let skillInput = document.createElement("input");
          skillInput.className = "skill-input";
          skillInput.placeholder = "Enter Skill";
          skillInput.value = skill.skill;

          let activityInput = document.createElement("input");
          activityInput.className = "activity-input";
          activityInput.placeholder = "Enter Activity";
          activityInput.value = skill.activity;

          // Create a counter to track the activity completion
          let counterSpan = document.createElement("span");
          counterSpan.className = "counter";
          counterSpan.innerText = `Completed: ${skill.completedCount || 0}`;

          // Button to mark activity as completed
          let markCompletedBtn = document.createElement("button");
          markCompletedBtn.innerText = "Mark as Completed";
          markCompletedBtn.className = "mark-completed-btn";

          // Handle click event to increment the completion counter
          markCompletedBtn.addEventListener("click", function () {
            let currentCount = parseInt(counterSpan.innerText.split(": ")[1]);
            counterSpan.innerText = `Completed: ${currentCount + 1}`;
          });

          skillDiv.appendChild(skillInput);
          skillDiv.appendChild(activityInput);
          skillDiv.appendChild(counterSpan);
          skillDiv.appendChild(markCompletedBtn);
          skillsContainer.appendChild(skillDiv);
        });

        let addSkillBtn = document.createElement("button");
        addSkillBtn.innerText = "+ Add Skill";
        addSkillBtn.className = "add-skill-btn";

        addSkillBtn.addEventListener("click", function () {
          let skillDiv = document.createElement("div");
          skillDiv.className = "skill";

          let skillInput = document.createElement("input");
          skillInput.className = "skill-input";
          skillInput.placeholder = "Enter Skill";

          let activityInput = document.createElement("input");
          activityInput.className = "activity-input";
          activityInput.placeholder = "Enter Activity";

          // Create a counter to track the activity completion
          let counterSpan = document.createElement("span");
          counterSpan.className = "counter";
          counterSpan.innerText = `Completed: 0`;

          // Button to mark activity as completed
          let markCompletedBtn = document.createElement("button");
          markCompletedBtn.innerText = "Mark as Completed";
          markCompletedBtn.className = "mark-completed-btn";

          // Handle click event to increment the completion counter
          markCompletedBtn.addEventListener("click", function () {
            let currentCount = parseInt(counterSpan.innerText.split(": ")[1]);
            counterSpan.innerText = `Completed: ${currentCount + 1}`;
          });

          skillDiv.appendChild(skillInput);
          skillDiv.appendChild(activityInput);
          skillDiv.appendChild(counterSpan);
          skillDiv.appendChild(markCompletedBtn);
          skillsContainer.appendChild(skillDiv);
        });

        stackDiv.appendChild(stackTitle);
        stackDiv.appendChild(skillsContainer);
        stackDiv.appendChild(addSkillBtn);
        document.getElementById("stacksContainer").appendChild(stackDiv);
      }

      // Add new stack on button click
      document
        .getElementById("addStackBtn")
        .addEventListener("click", function () {
          addStack();
        });

      // Save data to localStorage
      document.getElementById("saveBtn").addEventListener("click", function () {
        let stacks = document.querySelectorAll(".stack");
        let data = [];

        stacks.forEach((stack) => {
          let stackName = stack.querySelector(".stack-title").value;
          let skills = [];

          stack.querySelectorAll(".skill").forEach((skillDiv) => {
            let skill = skillDiv.querySelector(".skill-input").value;
            let activity = skillDiv.querySelector(".activity-input").value;
            let completedCount = skillDiv
              .querySelector(".counter")
              .innerText.split(": ")[1];
            skills.push({ skill, activity, completedCount });
          });

          data.push({ stackName, skills });
        });

        // Save the data to localStorage
        localStorage.setItem("omniStacksData", JSON.stringify(data));
        console.log("Saved Data:", JSON.stringify(data, null, 2));
      });

      // Export data as text with description for AI
      document
        .getElementById("exportBtn")
        .addEventListener("click", function () {
          let stacks = document.querySelectorAll(".stack");
          let exportText = "";

          stacks.forEach((stack) => {
            let stackName = stack.querySelector(".stack-title").value;
            exportText += `Stack: ${stackName}\n`;

            stack.querySelectorAll(".skill").forEach((skillDiv) => {
              let skill = skillDiv.querySelector(".skill-input").value;
              let activity = skillDiv.querySelector(".activity-input").value;
              let completedCount = skillDiv
                .querySelector(".counter")
                .innerText.split(": ")[1];
              exportText += `  - Skill: ${skill} | Activity: ${activity} | Completed: ${completedCount}\n`;
            });

            exportText += "\n";
          });

          // Create the brief description for AI
          const description = `
          Dear AI,

          This user is progressing through their self-improvement routine. Below is the data on their activities:
          - The "stack" represents a group of tasks or skills.
          - Each "skill" contains tasks with the corresponding count of completions.

          Their current progress is tracked by the number of times they've completed activities. Please consider the following factors when calculating their tetrational or hexational productivity:
          1. **Tetrational Productivity**: This refers to the user's exponential growth based on their consistent activities and cumulative effort. Each task completed represents a step in that growth. The higher the number of completions, the more significant the result.
          2. **Hexational Productivity**: This is about achieving results that lead to an accelerating cycle. It refers to optimizing and streamlining tasks that not only lead to immediate results but set the user on a trajectory of compound improvement.

          **Honoring Their Achievement**: For each task completed, give recognition, with a particular focus on streaks and significant milestones.

          **Advice for Improvement**:
          - Consider suggesting ways to increase the number of repetitions or improve efficiency in each skill.
          - Encourage them to set higher goals based on their successes.
          - Offer motivational advice like: "Great progress! Keep up the momentum, and aim for 10 more completions in the next session to accelerate your growth."

          **Suggestions for the User**:
          - If possible, suggest routine modifications to target new skills or combine activities for a synergistic result.
          - Always ask for clarification when needed to understand how they prefer to be assisted in their personal journey.

          Best of luck with optimizing their growth and results!

          User's progress data:
          ${exportText}
          `;

          // Copy the text to clipboard
          navigator.clipboard.writeText(description).then(
            function () {
              alert("Plan and AI-guided description exported to clipboard!");
            },
            function (err) {
              console.error("Failed to copy text: ", err);
            }
          );
        });
    </script>
  </body>
</html>
